<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Challenges - GreenLink</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="icon" type="image/svg+xml" href="/images/logo.svg">
    <link rel="shortcut icon" type="image/svg+xml" href="/images/logo.svg">
    <style>
        .hero-section {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            padding: 4rem 0;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='rgba(255,255,255,0.1)' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.2;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .stats-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: white;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.75rem 2rem rgba(0, 0, 0, 0.12);
        }

        .challenge-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            background: white;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .challenge-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.75rem 2rem rgba(0, 0, 0, 0.12);
        }

        .challenge-card.completed {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.05) 0%, rgba(32, 201, 151, 0.05) 100%);
            border: 2px solid rgba(40, 167, 69, 0.2);
        }

        .challenge-card.completed::before {
            content: 'âœ“';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #28a745;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            z-index: 10;
        }

        .challenge-card.in-progress {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.05) 0%, rgba(255, 152, 0, 0.05) 100%);
            border: 2px solid rgba(255, 193, 7, 0.2);
        }

        .category-header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .category-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='rgba(255,255,255,0.1)' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.2;
        }

        .category-content {
            position: relative;
            z-index: 1;
        }

        .category-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .badge-name {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 1rem;
        }

        .challenge-emoji {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .points-badge {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .progress {
            height: 0.8rem;
            border-radius: 1rem;
            background-color: rgba(40, 167, 69, 0.1);
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border-radius: 1rem;
            transition: width 0.5s ease;
        }

        .status-indicator {
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-not-started {
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
        }

        .status-in-progress {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }

        .status-completed {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }

        .stats-icon {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .challenge-description {
            color: #6c757d;
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .progress-text {
            font-size: 0.8rem;
            color: #6c757d;
            margin-top: 0.5rem;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .challenge-card.completed {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body class="bg-light">
<!-- Navbar -->
<nav th:replace="fragments/navbar :: navbar"></nav>

<!-- Hero Section -->
<header class="hero-section">
    <div class="container hero-content">
        <div class="row justify-content-center text-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold mb-3">Environmental Challenges</h1>
                <p class="lead fs-4 mb-0">Complete challenges, earn points, and make a real impact on the environment</p>
            </div>
        </div>
    </div>
</header>

<div class="container py-5">
    <!-- Progress Overview -->
    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="stats-card">
                <div class="card-body text-center p-4">
                    <i class="bi bi-trophy-fill stats-icon"></i>
                    <h5 class="card-title mb-3">Total Points</h5>
                    <p class="display-6 text-success mb-0 fw-bold" th:text="${totalPoints ?: '0'}">0</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card">
                <div class="card-body text-center p-4">
                    <i class="bi bi-check-circle-fill stats-icon"></i>
                    <h5 class="card-title mb-3">Completed</h5>
                    <p class="display-6 text-success mb-0 fw-bold" th:text="${completedCount ?: '0'}">0</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stats-card">
                <div class="card-body text-center p-4">
                    <i class="bi bi-lightning-fill stats-icon"></i>
                    <h5 class="card-title mb-3">Current Streak</h5>
                    <p class="display-6 text-success mb-0 fw-bold" th:text="${currentStreak ?: '0'} + ' days'">0 days</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Challenge Categories -->
    <div th:if="${userChallengesByCategory}" th:each="categoryEntry : ${userChallengesByCategory}">
        <div class="category-header">
            <div class="category-content text-center">
                <div class="category-icon" th:text="${categoryEntry.key.icon}">ðŸŒ±</div>
                <h2 class="mb-2" th:text="${categoryEntry.key.displayName}">Default Challenges</h2>
                <p class="mb-0 opacity-75" th:text="${categoryEntry.key.description}">Basic onboarding challenges</p>
            </div>
        </div>

        <div class="row g-4 mb-5">
            <div th:each="userChallenge : ${categoryEntry.value}" class="col-md-6 col-lg-4">
                <div class="challenge-card" th:classappend="${userChallenge.status.name().toLowerCase()}">
                    <div class="card-body p-4">
                        <div class="text-center mb-3">
                            <div class="challenge-emoji" th:text="${userChallenge.challenge.emoji}">ðŸŒ±</div>
                            <div class="badge-name" th:text="${userChallenge.challenge.badgeName}">Badge Name</div>
                        </div>
                        
                        <h5 class="card-title text-center mb-3" th:text="${userChallenge.challenge.title}">Challenge Title</h5>
                        <p class="challenge-description text-center" th:text="${userChallenge.challenge.description}">Challenge description</p>
                        
                        <div class="text-center mb-3">
                            <span class="points-badge">
                                <i class="bi bi-coin me-2"></i>
                                <span th:text="${userChallenge.challenge.points}">50</span> points
                            </span>
                        </div>

                        <div class="progress">
                            <div class="progress-bar" role="progressbar" 
                                 th:style="'width: ' + ${userChallenge.progressPercentage} + '%'"
                                 th:attr="aria-valuenow=${userChallenge.progressPercentage}"
                                 aria-valuemin="0" aria-valuemax="100">
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <span class="status-indicator" 
                                  th:classappend="'status-' + ${userChallenge.status.name().toLowerCase().replace('_', '-')}"
                                  th:text="${userChallenge.status.displayName}">Not started</span>
                        </div>
                        
                        <div class="progress-text text-center">
                            <span th:text="${userChallenge.currentValue}">0</span> / <span th:text="${userChallenge.challenge.targetValue}">1</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div th:if="${!userChallengesByCategory || userChallengesByCategory.isEmpty()}" class="text-center py-5">
        <i class="bi bi-emoji-smile display-1 text-muted mb-4"></i>
        <h3 class="text-muted">No challenges available yet</h3>
        <p class="text-muted">Challenges will appear here once they're set up.</p>
    </div>
</div>

<!-- Footer -->
<footer th:replace="fragments/footer :: footer"></footer>

<!-- Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Challenge Scripts -->
<script>
// Auto-refresh progress bars with animation
function animateProgressBars() {
    const progressBars = document.querySelectorAll('.progress-bar');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 100);
    });
}

// Initialize animations when page loads
document.addEventListener('DOMContentLoaded', function() {
    animateProgressBars();
});

// Function to trigger challenge events (for testing)
function triggerEvent(event, increment = 1) {
    fetch(`/provocari/event/${event}?increment=${increment}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.text())
    .then(result => {
        if (result === 'success') {
            window.location.reload();
        } else {
            console.error('Failed to trigger event:', result);
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

// Add some test buttons for development (remove in production)
if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
    console.log('Development mode: Challenge events can be triggered via console');
    console.log('Example: triggerEvent("lesson_completed", 1)');
    console.log('Available events: avatar_created, lesson_completed, photo_uploaded, quiz_completed, item_listed, carbon_calculated, map_explored, offer_made, message_sent, item_favorited, friend_added, item_purchased');
}
</script>

<!-- Include the login modal script -->
<div th:replace="fragments/login-modal :: loginModalScript"></div>
</body>
</html>

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenLink - Lec»õia 5: PlanteazƒÉ ceva (chiar »ôi √Æntr-un ghiveci!)</title>
    <meta name="_csrf" th:content="${_csrf != null ? _csrf.token : ''}"/>
    <meta name="_csrf_header" th:content="${_csrf != null ? _csrf.headerName : 'X-CSRF-TOKEN'}"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="icon" type="image/svg+xml" href="/images/logo.svg">
    <style>
        .course-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        .course-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
            border-radius: 15px;
        }
        .lesson-section {
            background: white;
            border-radius: 15px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-left: 5px solid #28a745;
        }
        .paragraph-number {
            background: #28a745;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        .quiz-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
            border: 2px solid #e9ecef;
        }
        .quiz-option {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 1.2rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        .quiz-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            border-color: #28a745;
        }
        .quiz-option.selected {
            border-color: #28a745;
            background-color: #d4edda;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.2);
        }
        .quiz-option.correct {
            border-color: #28a745;
            background-color: #d4edda;
        }
        .quiz-option.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
        }
        .quiz-section.locked .quiz-option {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .quiz-section.locked .quiz-option:hover {
            transform: none;
            box-shadow: none;
            border-color: #dee2e6;
        }
        .highlight-box {
            background: linear-gradient(135deg, #e8f5e9, #f0f8f0);
            border-left: 5px solid #28a745;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 12px 12px 0;
        }
        .bullet-list {
            padding-left: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .bullet-list li {
            margin-bottom: 1rem;
            position: relative;
            padding-left: 0.5rem;
            line-height: 1.6;
        }
        .section-subtitle {
            color: #28a745;
            font-weight: 600;
            margin: 2rem 0 1rem;
            font-size: 1.3rem;
        }
        .quiz-question {
            margin-bottom: 2.5rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid #e9ecef;
        }
        .quiz-question:last-child {
            border-bottom: none;
        }
        .quiz-result {
            text-align: center;
            padding: 2rem;
            border-radius: 15px;
            margin-top: 2rem;
            display: none;
        }
        .quiz-result.success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border: 2px solid #28a745;
            color: #155724;
        }
        .quiz-result.warning {
            background: linear-gradient(135deg, #fff3cd, #ffeeba);
            border: 2px solid #ffc107;
            color: #856404;
        }
        .progress-container {
            margin: 2rem 0;
        }
        .progress {
            height: 12px;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            background-color: #e9ecef;
        }
        .progress-bar {
            background: linear-gradient(90deg, #28a745, #20c997);
            border-radius: 6px;
        }
        .progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #6c757d;
            font-weight: 500;
        }
        .points-badge {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 50px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        .final-task {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 2.5rem;
            margin-top: 3rem;
            border: 2px solid #dee2e6;
        }
        .task-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .back-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }
        .back-button:hover {
            background: #5a6268;
            color: white;
            text-decoration: none;
            transform: translateY(-2px);
        }
        .lesson-completed {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            border: 2px solid #28a745;
            text-align: center;
        }
        .reflection-input {
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 1rem;
            width: 100%;
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        .reflection-input:focus {
            border-color: #28a745;
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
            outline: none;
        }
        
        /* Custom completion modal styles */
        .completion-modal .modal-content {
            border: none;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            overflow: hidden;
        }
        
        .completion-modal .modal-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 2rem;
            text-align: center;
            position: relative;
        }
        
        .completion-modal .modal-header::before {
            content: 'üéâ';
            position: absolute;
            top: -10px;
            left: 20px;
            font-size: 2rem;
            animation: bounce 2s infinite;
        }
        
        .completion-modal .modal-header::after {
            content: '‚≠ê';
            position: absolute;
            top: -5px;
            right: 20px;
            font-size: 1.5rem;
            animation: sparkle 2s infinite;
        }
        
        .completion-modal .modal-title {
            font-size: 2rem;
            font-weight: bold;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .completion-modal .modal-body {
            padding: 2.5rem;
            text-align: center;
            background: white;
        }
        
        .completion-modal .modal-body p {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: #495057;
        }
        
        .completion-modal .score-highlight {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 1rem 2rem;
            border-radius: 50px;
            display: inline-block;
            font-size: 1.4rem;
            font-weight: bold;
            margin-top: 1rem;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .completion-modal .modal-footer {
            background: #f8f9fa;
            border: none;
            padding: 2rem;
            text-align: left;
        }
        
        .completion-modal .btn-continue {
            background: linear-gradient(135deg, #28a745, #20c997);
            border: none;
            padding: 1rem 3rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            transition: all 0.3s ease;
        }
        
        .completion-modal .btn-continue:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .completion-modal .btn-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            opacity: 0.8;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .completion-modal .btn-close:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.3);
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        @keyframes sparkle {
            0%, 100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(1.2) rotate(180deg);
                opacity: 0.8;
            }
        }
    </style>
</head>
<body class="bg-light">
    <!-- Navbar -->
    <nav th:replace="fragments/navbar :: navbar"></nav>

    <!-- Course Header -->
    <header class="course-header text-center">
        <div class="container">
            <h1 class="display-4" th:text="#{course.5.title}">üå± Lec»õia 5: PlanteazƒÉ ceva (chiar »ôi √Æntr-un ghiveci!)</h1>
            <p class="lead" th:text="#{course.5.subtitle}">ConecteazƒÉ-te cu natura prin plantat</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="course-container">
        <!-- Back Button -->
        <a href="/educatie" class="back-button">
            <i class="bi bi-arrow-left"></i>
            <span th:text="#{course.back.button}">√énapoi la harta cursurilor</span>
        </a>

        <!-- Lesson completed message -->
        <div class="lesson-completed" th:if="${lessonCompleted}" sec:authorize="isAuthenticated()">
            <i class="bi bi-check-circle-fill me-2" style="font-size: 1.5rem;"></i>
            <strong th:text="#{course.lesson.completed}">FelicitƒÉri! Ai completat aceastƒÉ lec»õie cu succes!</strong>
        </div>
        
        <!-- Hidden authentication status indicator -->
        <input type="hidden" id="authenticated-status" sec:authorize="isAuthenticated()" value="true">

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-label">
                <span th:text="#{course.lesson.progress}">Progresul lec»õiei</span>
                <span id="progress-text">0/5</span>
            </div>
            <div class="progress">
                <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
            </div>
        </div>

        <!-- Paragraph 1 -->
        <section class="lesson-section">
            <div class="paragraph-number">1</div>
            <h2>De ce e important sƒÉ plantezi ceva</h2>
            
            <p class="lead mb-4">
                Plantele joacƒÉ un rol esen»õial √Æn via»õa noastrƒÉ, chiar dacƒÉ uneori nu le acordƒÉm aten»õia meritatƒÉ. Ele curƒÉ»õƒÉ aerul, rƒÉcesc mediul √ÆnconjurƒÉtor, atrag insecte benefice »ôi contribuie la sƒÉnƒÉtatea noastrƒÉ fizicƒÉ »ôi mentalƒÉ.
            </p>

            <div class="highlight-box">
                <h4 class="section-subtitle">Chiar »ôi o singurƒÉ plantƒÉ √Æntr-un ghiveci mic:</h4>
                <ul class="bullet-list">
                    <li><strong>üåø Absoarbe dioxidul de carbon »ôi produce oxigen</strong></li>
                    <li><strong>üíß AjutƒÉ la reglarea umiditƒÉ»õii din aer</strong></li>
                    <li><strong>üòä OferƒÉ o stare de calm »ôi reduce stresul</strong></li>
                </ul>
            </div>

            <p>
                Nu ai nevoie de o grƒÉdinƒÉ pentru a avea grijƒÉ de o plantƒÉ. Po»õi √Æncepe cu ceva simplu, cum ar fi busuioc, ceapƒÉ verde, mentƒÉ sau chiar o plantƒÉ ornamentalƒÉ. Cu pu»õinƒÉ grijƒÉ, vei vedea cum cre»ôte ‚Äî »ôi cu ea »ôi responsabilitatea ta fa»õƒÉ de naturƒÉ.
            </p>

            <!-- Quiz for Paragraph 1 -->
            <div class="quiz-section" data-attempts="0">
                <h4><i class="bi bi-question-circle me-2"></i>√éntrebare 1:</h4>
                <p class="mb-3"><strong>Ce face o plantƒÉ, chiar »ôi √Æntr-un ghiveci mic?</strong></p>
                
                <div class="quiz-option" data-correct="false">
                    <strong>A)</strong> PolueazƒÉ aerul
                </div>
                <div class="quiz-option" data-correct="true">
                    <strong>B)</strong> Produce oxigen
                </div>
                <div class="quiz-option" data-correct="false">
                    <strong>C)</strong> Cre»ôte plastic
                </div>
                <div class="quiz-option" data-correct="false">
                    <strong>D)</strong> ConsumƒÉ energie electricƒÉ
                </div>

                <div class="quiz-result" id="result-1"></div>
            </div>
        </section>

        <!-- Paragraph 2 -->
        <section class="lesson-section">
            <div class="paragraph-number">2</div>
            <h2>Plantele te ajutƒÉ sƒÉ te reconectezi cu natura</h2>
            
            <p class="lead mb-4">
                √én via»õa de zi cu zi, suntem deseori deconecta»õi de la naturƒÉ ‚Äî stƒÉm √Æn case, mergem cu ma»ôina, privim ecrane. Plantatul e o formƒÉ simplƒÉ, dar eficientƒÉ, de a reaprinde legƒÉtura cu pƒÉm√¢ntul »ôi cu ciclurile naturale.
            </p>

            <div class="highlight-box">
                <h4 class="section-subtitle">C√¢nd plantezi »ôi √Ængrije»ôti o plantƒÉ:</h4>
                <ul class="bullet-list">
                    <li><strong>üëÄ Vezi √Æn mod direct cum cre»ôte ceva</strong> datoritƒÉ grijii tale</li>
                    <li><strong>üß† √énve»õi despre rƒÉbdare »ôi procese naturale</strong></li>
                    <li><strong>üí° Devii mai atent(ƒÉ) la consumul tƒÉu</strong> ‚Äî apƒÉ, sol, lumina necesarƒÉ</li>
                </ul>
            </div>

            <p>
                Chiar »ôi copii sau persoane fƒÉrƒÉ experien»õƒÉ pot √ÆnvƒÉ»õa rapid. Este un gest care √Æ»õi aduce bucurie »ôi √Æn acela»ôi timp √Æ»õi dezvoltƒÉ respectul fa»õƒÉ de naturƒÉ.
            </p>

            <!-- Quiz for Paragraph 2 -->
            <div class="quiz-section" data-attempts="0">
                <h4><i class="bi bi-question-circle me-2"></i>√éntrebare 2:</h4>
                <p class="mb-3"><strong>Ce te √Ænva»õƒÉ plantatul?</strong></p>
                
                <div class="quiz-option" data-correct="false">
                    <strong>A)</strong> SƒÉ consumi mai mult
                </div>
                <div class="quiz-option" data-correct="false">
                    <strong>B)</strong> SƒÉ grƒÉbe»ôti procesele
                </div>
                <div class="quiz-option" data-correct="true">
                    <strong>C)</strong> SƒÉ ai rƒÉbdare »ôi grijƒÉ
                </div>
                <div class="quiz-option" data-correct="false">
                    <strong>D)</strong> SƒÉ evi»õi natura
                </div>

                <div class="quiz-result" id="result-2"></div>
            </div>
        </section>

        <!-- Paragraph 3 -->
        <section class="lesson-section">
            <div class="paragraph-number">3</div>
            <h2>Cum po»õi planta ceva simplu, chiar acum</h2>
            
            <p class="lead mb-4">
                Nu ai nevoie de materiale sofisticate. IatƒÉ cum po»õi √Æncepe imediat:
            </p>

            <div class="highlight-box">
                <h4 class="section-subtitle">Pa»ôi simpli pentru a √Æncepe:</h4>
                <ul class="bullet-list">
                    <li><strong>ü•¨ Ia resturi de ceapƒÉ verde sau salatƒÉ</strong> ‚Äì pune-le √Æntr-un pahar cu apƒÉ »ôi vei vedea cum cresc din nou!</li>
                    <li><strong>üåø CumpƒÉrƒÉ un plic cu semin»õe de busuioc, mentƒÉ sau ridichi</strong> ‚Äì u»ôor de crescut √Æn ghivece.</li>
                    <li><strong>üå± Folose»ôte un ghiveci vechi, un borcan sau chiar o cutie de iaurt</strong> ca recipient.</li>
                    <li><strong>üíß UdƒÉ-le zilnic »ôi pune-le la luminƒÉ naturalƒÉ.</strong></li>
                </ul>
            </div>

            <p>
                Nu existƒÉ ‚Äûprea mic" c√¢nd vine vorba de plantat. Fiecare frunzƒÉ conteazƒÉ. »òi e foarte satisfƒÉcƒÉtor sƒÉ vezi ceva verde cresc√¢nd din m√¢inile tale.
            </p>

            <!-- Quiz for Paragraph 3 -->
            <div class="quiz-section" data-attempts="0">
                <h4><i class="bi bi-question-circle me-2"></i>√éntrebare 3:</h4>
                <p class="mb-3"><strong>Ce po»õi folosi ca ghiveci pentru a planta?</strong></p>
                
                <div class="quiz-option" data-correct="true">
                    <strong>A)</strong> Un borcan sau o cutie de iaurt
                </div>
                <div class="quiz-option" data-correct="false">
                    <strong>B)</strong> O pungƒÉ de plastic
                </div>
                <div class="quiz-option" data-correct="false">
                    <strong>C)</strong> O sticlƒÉ cu ulei
                </div>
                <div class="quiz-option" data-correct="false">
                    <strong>D)</strong> O cutie de carton murdar
                </div>

                <div class="quiz-result" id="result-3"></div>
            </div>
        </section>

        <!-- Paragraph 4 -->
        <section class="lesson-section">
            <div class="paragraph-number">4</div>
            <h2>Ce plante sunt potrivite pentru √ÆncepƒÉtori</h2>
            
            <p class="lead mb-4">
                DacƒÉ e»ôti la √Ænceput, alege plante care cresc u»ôor »ôi nu cer prea multƒÉ √Æntre»õinere. IatƒÉ c√¢teva recomandƒÉri:
            </p>

            <div class="highlight-box">
                <h4 class="section-subtitle">Plante u»ôor de crescut:</h4>
                <ul class="bullet-list">
                    <li><strong>üåø Busuioc</strong> ‚Äì germineazƒÉ repede »ôi miroase frumos</li>
                    <li><strong>üßÖ CeapƒÉ verde</strong> ‚Äì cre»ôte chiar »ôi √Æn apƒÉ</li>
                    <li><strong>üå± Ridichi</strong> ‚Äì cresc rapid, chiar »ôi √Æn spa»õii mici</li>
                    <li><strong>üåº Menta</strong> ‚Äì rezistentƒÉ, idealƒÉ pentru ceaiuri</li>
                </ul>
            </div>

            <p>
                E important sƒÉ alegi plante care √Æ»õi plac ‚Äî a»ôa vei fi mai motivat(ƒÉ) sƒÉ ai grijƒÉ de ele. Po»õi √Æncepe cu una singurƒÉ »ôi, treptat, sƒÉ creezi un mic col»õ verde √Æn camera ta sau pe balcon.
            </p>

            <!-- Quiz for Paragraph 4 -->
            <div class="quiz-section" data-attempts="0">
                <h4><i class="bi bi-question-circle me-2"></i>√éntrebare 4:</h4>
                <p class="mb-3"><strong>Care dintre urmƒÉtoarele plante este u»ôor de crescut √Æntr-un apartament?</strong></p>
                
                <div class="quiz-option" data-correct="true">
                    <strong>A)</strong> Menta
                </div>
                <div class="quiz-option" data-correct="false">
                    <strong>B)</strong> Trandafirul sƒÉlbatic
                </div>
                <div class="quiz-option" data-correct="false">
                    <strong>C)</strong> Arborele de mango
                </div>
                <div class="quiz-option" data-correct="false">
                    <strong>D)</strong> PƒÉrul
                </div>

                <div class="quiz-result" id="result-4"></div>
            </div>
        </section>

        <!-- Paragraph 5 -->
        <section class="lesson-section">
            <div class="paragraph-number">5</div>
            <h2>FƒÉ-»õi propria ta legƒÉturƒÉ cu pƒÉm√¢ntul</h2>
            
            <p class="lead mb-4">
                SƒÉ vezi cum cre»ôte ceva din m√¢inile tale √Æ»õi oferƒÉ un sentiment unic. Nu doar cƒÉ ai creat ceva, dar te »ôi conectezi cu ceva viu. Este un mic act de grijƒÉ fa»õƒÉ de planetƒÉ, dar »ôi fa»õƒÉ de tine.
            </p>

            <div class="highlight-box">
                <h4 class="section-subtitle">Mul»õi oameni care √Æncep cu o plantƒÉ ajung sƒÉ:</h4>
                <ul class="bullet-list">
                    <li><strong>üå± Dezvolte o pasiune pentru grƒÉdinƒÉrit</strong></li>
                    <li><strong>üåç DevinƒÉ mai aten»õi la sezon, vreme »ôi tipuri de sol</strong></li>
                    <li><strong>ü•ó √é»ôi doreascƒÉ sƒÉ consume mai sustenabil »ôi local</strong></li>
                </ul>
            </div>

            <p>
                Totul √Æncepe cu un ghiveci, o m√¢nƒÉ de pƒÉm√¢nt »ôi un pic de rƒÉbdare. Natura te rƒÉsplƒÉte»ôte cu verde, via»õƒÉ »ôi lini»ôte.
            </p>

            <!-- Quiz for Paragraph 5 -->
            <div class="quiz-section" data-attempts="0">
                <h4><i class="bi bi-question-circle me-2"></i>√éntrebare 5:</h4>
                <p class="mb-3"><strong>Ce sentiment po»õi avea dupƒÉ ce ai crescut o plantƒÉ?</strong></p>
                
                <div class="quiz-option" data-correct="false">
                    <strong>A)</strong> Frustrare
                </div>
                <div class="quiz-option" data-correct="true">
                    <strong>B)</strong> Conectare »ôi satisfac»õie
                </div>
                <div class="quiz-option" data-correct="false">
                    <strong>C)</strong> Indiferen»õƒÉ
                </div>
                <div class="quiz-option" data-correct="false">
                    <strong>D)</strong> PlictisealƒÉ
                </div>

                <div class="quiz-result" id="result-5"></div>
            </div>
        </section>

        <!-- Final Task -->
        <section class="final-task">
            <h2 class="text-center mb-4">‚úÖ Sarcina finalƒÉ</h2>
            
            <div class="task-section">
                <h4><i class="bi bi-camera me-2"></i>Foto (10 pts)</h4>
                <p>
                    FƒÉ o pozƒÉ cu planta ta ‚Äî poate fi semin»õa plantatƒÉ, un borcan cu ceapƒÉ verde, un ghiveci improvizat sau orice ai √Ænceput sƒÉ cre»ôti.
                </p>
                <input type="file" class="form-control" id="image-upload" accept="image/*">
                <div class="mt-2">
                    <label id="upload-label">Nu ai √ÆncƒÉ √ÆncƒÉrcat nicio imagine.</label>
                    <img id="image-preview" src="" alt="Imagine propusƒÉ" style="display: none; max-width: 100%; height: auto; margin-top: 10px;">
                </div>
            </div>

            <div class="task-section">
                <h4><i class="bi bi-pencil me-2"></i>Scrie (5 pts)</h4>
                <p class="mb-3">
                    Scrie o propozi»õie despre cum te-a fƒÉcut sƒÉ te sim»õi faptul cƒÉ ai plantat »ôi √Ængrijit ceva cu m√¢inile tale.
                </p>
                <textarea 
                    class="reflection-input" 
                    id="reflection-text" 
                    placeholder="Scrie aici reflec»õia ta..."
                    rows="4"></textarea>
            </div>

            <div class="text-center">
                <button class="btn btn-success btn-lg" id="complete-lesson" disabled>
                    <i class="bi bi-check-circle me-2"></i>
                    CompleteazƒÉ lec»õia
                </button>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer th:replace="fragments/footer :: footer"></footer>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">
                        <i class="bi bi-lock me-2"></i>Autentificare necesarƒÉ
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Pentru a completa lec»õia »ôi a-»õi salva progresul, trebuie sƒÉ fii autentificat.</p>
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>De ce?</strong> Vrem sƒÉ-»õi salvƒÉm progresul »ôi sƒÉ-»õi oferim o experien»õƒÉ personalizatƒÉ.
                    </div>
                </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">AnuleazƒÉ</button>
                        <a href="/login?redirect=curs5" class="btn btn-success">
                            <i class="bi bi-box-arrow-in-right me-2"></i>Autentificare
                        </a>
                    </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let attemptedQuestions = 0;
        const totalQuestions = 5;
        let answers = {};
        let questionScores = {};
        let totalScore = 0;

        // Check if user is authenticated
        function isAuthenticated() {
            // Use a hidden input field that's only rendered for authenticated users
            return document.getElementById('authenticated-status') !== null;
        }

        // Quiz functionality with enhanced scoring
        document.querySelectorAll('.quiz-option').forEach(option => {
            option.addEventListener('click', function() {
                const questionSection = this.closest('.quiz-section');
                const questionNumber = Array.from(document.querySelectorAll('.quiz-section')).indexOf(questionSection) + 1;
                const questionId = `question_${questionNumber}`;
                
                // Check if this question is locked (after second wrong attempt)
                if (questionSection.classList.contains('locked')) {
                    return; // Question is locked, no more attempts allowed
                }
                
                // Check if this question was already answered correctly
                if (questionScores[questionId] === 5) {
                    return; // Question already completed with points
                }
                
                // Remove previous selections in this question
                questionSection.querySelectorAll('.quiz-option').forEach(opt => {
                    opt.classList.remove('selected', 'correct', 'incorrect');
                });
                
                // Select this option
                this.classList.add('selected');
                
                // Check if correct
                const isCorrect = this.getAttribute('data-correct') === 'true';
                
                if (isCorrect) {
                    this.classList.add('correct');
                    
                    // Award 5 points for correct answer on first attempt
                    const points = 5;
                    
                    questionScores[questionId] = points;
                    totalScore += points;
                    
                    if (!answers[questionNumber]) {
                        attemptedQuestions++;
                        answers[questionNumber] = true;
                        updateProgress();
                    }
                    
                    // Show success message
                    const resultDiv = questionSection.querySelector('.quiz-result');
                    resultDiv.style.display = 'block';
                    resultDiv.className = 'quiz-result success';
                    resultDiv.innerHTML = `<i class="bi bi-check-circle-fill me-2"></i>Corect! +${points} puncte!`;
                    
                    // Lock the question after correct answer
                    questionSection.classList.add('locked');
                    
                } else {
                    this.classList.add('incorrect');
                    
                    // Wrong answer - show correct answer and lock question immediately
                    questionSection.querySelector('[data-correct="true"]').classList.add('correct');
                    questionSection.classList.add('locked'); // Lock the question
                    
                    const resultDiv = questionSection.querySelector('.quiz-result');
                    resultDiv.style.display = 'block';
                    resultDiv.className = 'quiz-result warning';
                    resultDiv.innerHTML = '<i class="bi bi-x-circle-fill me-2"></i>Gre»ôit! 0 puncte. RƒÉspunsul corect este eviden»õiat.';
                    
                    // Mark as attempted but with 0 points
                    if (!answers[questionNumber]) {
                        attemptedQuestions++;
                        answers[questionNumber] = true;
                        updateProgress();
                    }
                }
                
                updateScoreDisplay();
            });
        });

        function updateProgress() {
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const percentage = (attemptedQuestions / totalQuestions) * 100;
            
            progressBar.style.width = percentage + '%';
            progressText.textContent = `${attemptedQuestions}/${totalQuestions}`;
            
            // Enable final task if all questions attempted (regardless of points)
            const finalTask = document.querySelector('.final-task');
            if (attemptedQuestions === totalQuestions) {
                finalTask.style.opacity = '1';
                finalTask.style.pointerEvents = 'auto';
            }
            
            // Enable complete button if all questions attempted and reflection written
            const reflectionText = document.getElementById('reflection-text').value.trim();
            const imageUploaded = document.getElementById('image-upload').files.length > 0;
            const completeButton = document.getElementById('complete-lesson');
            completeButton.disabled = !(attemptedQuestions === totalQuestions && reflectionText.length > 0);
        }

        function updateScoreDisplay() {
            const scoreDisplay = document.getElementById('score-display');
            if (scoreDisplay) {
                scoreDisplay.textContent = `Puncte: ${totalScore}/40`;
            }
        }

        // Reflection text input
        document.getElementById('reflection-text').addEventListener('input', function() {
            updateProgress();
        });

        // Image upload handling
        document.getElementById('image-upload').addEventListener('change', function() {
            const file = this.files[0];
            const imagePreview = document.getElementById('image-preview');
            const uploadLabel = document.getElementById('upload-label');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                    uploadLabel.textContent = 'Imagine √ÆncƒÉrcatƒÉ ‚úì';
                    uploadLabel.style.color = '#28a745';
                };
                reader.readAsDataURL(file);
            }
        });

        // Complete lesson
        document.getElementById('complete-lesson').addEventListener('click', function() {
            const reflectionText = document.getElementById('reflection-text').value.trim();
            const imageUploaded = document.getElementById('image-upload').files.length > 0;
            
            if (attemptedQuestions === totalQuestions && reflectionText.length > 0) {
                // Check if user is authenticated
                if (!isAuthenticated()) {
                    // Show login modal
                    const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                    loginModal.show();
                    return;
                }
                
                // Calculate final score
                let finalScore = totalScore;
                if (reflectionText.length > 0) finalScore += 5; // Reflection points
                if (imageUploaded) finalScore += 10; // Image upload points
                
                // User is authenticated, submit lesson completion to server
                const submissionData = {
                    correctAnswers: totalScore / 5, // Convert score to correct answers
                    totalQuestions: totalQuestions,
                    reflectionText: reflectionText,
                    imageUploaded: imageUploaded
                };
                
                // Get CSRF token
                const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
                const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');
                
                // Submit to server
                fetch('/educatie/quiz/5/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        [csrfHeader]: csrfToken
                    },
                    body: JSON.stringify(submissionData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Show completion modal
                        const completionModalHTML = `
                            <div class="modal completion-modal" tabindex="-1" role="dialog" id="completionModal">
                                <div class="modal-dialog modal-dialog-centered" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">
                                                Lec»õia 5: PlanteazƒÉ ceva (chiar »ôi √Æntr-un ghiveci!)
                                            </h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <p>FelicitƒÉri! Ai completat cu succes aceastƒÉ lec»õie importantƒÉ!</p>
                                            <p>Ai √ÆnvƒÉ»õat cum sƒÉ planezi »ôi sƒÉ √Ængrijei»ôti plante, transform√¢nd spa»õiul tƒÉu √Æntr-un mediu mai verde »ôi mai sƒÉnƒÉtos!</p>
                                            <div class="score-highlight">Scor final: ${finalScore}/40</div>
                                            <div class="score-highlight">Puncte c√¢»ôtigate: ${data.pointsEarned}</div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-continue" data-bs-dismiss="modal" onclick="window.location.href = '/educatie?completed=5'">ContinuƒÉ cƒÉtre harta educativƒÉ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        // Append modal to the body
                        document.body.insertAdjacentHTML('beforeend', completionModalHTML);

                        // Show the modal
                        const completionModal = new bootstrap.Modal(document.getElementById('completionModal'));
                        completionModal.show();
                        
                        // Mark lesson as completed in localStorage
                        localStorage.setItem('lesson_5_completed', 'true');
                        localStorage.setItem('lesson_5_score', finalScore);
                    } else {
                        alert('Eroare la salvarea lec»õiei: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Eroare la comunicarea cu serverul');
                });
            }
        });

        // Initialize final task as disabled
        document.addEventListener('DOMContentLoaded', function() {
            const finalTask = document.querySelector('.final-task');
            finalTask.style.opacity = '0.5';
            finalTask.style.pointerEvents = 'none';
        });
    </script>
</body>
</html> 
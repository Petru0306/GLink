<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${user != null ? (user.firstName + ' ' + user.lastName + ' - My Profile - GreenLink') : 'My Profile - GreenLink'}">My Profile - GreenLink</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/styles.css?v=1.0.2">
    <link rel="stylesheet" href="/css/profile.css?v=1.0">
    <link rel="icon" type="image/svg+xml" href="/images/logo.svg">
    <link rel="shortcut icon" type="image/svg+xml" href="/images/logo.svg">
</head>
<body>
    <!-- Navbar -->
    <nav th:replace="fragments/navbar :: navbar"></nav>

    <!-- Profile Header -->
    <div class="profile-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-3 text-center text-md-start">
                    <!-- Profile Avatar -->
                    <div class="profile-avatar-placeholder">
                        <i class="bi bi-person-circle"></i>
                    </div>
                </div>
                <div class="col-md-6 text-center text-md-start">
                    <!-- Profile Info -->
                    <h1 class="profile-name" th:text="${user != null ? (user.firstName + ' ' + user.lastName) : 'User Name'}">User Name</h1>
                    <p class="profile-username" th:text="${user != null ? ('@' + user.username) : '@username'}">@username</p>
                    <div class="eco-score">
                        <i class="bi bi-trophy-fill"></i>
                        <span th:text="${user != null ? user.points : 0}">0</span> GreenLink Points
                        <span class="badge bg-light text-dark ms-2">Level <span th:text="${user != null ? user.level : 1}">1</span></span>
                    </div>
                    <div class="level-progress mt-2">
                        <small class="text-light">Progress to next level</small>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-warning" role="progressbar" 
                                 th:style="'width: ' + ${user != null ? user.progressToNextLevel : 0} + '%'"
                                 th:text="${user != null ? user.progressToNextLevel : 0} + '%'">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 text-center text-md-end">
                    <!-- Edit Profile Button -->
                    <a href="/profile/edit" class="btn btn-outline-light">
                        <i class="bi bi-pencil me-2"></i>Edit Profile
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="container">
        <ul class="nav nav-tabs" id="profileTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">
                    <i class="bi bi-house me-2"></i>Overview
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="challenges-tab" data-bs-toggle="tab" data-bs-target="#challenges" type="button" role="tab" aria-controls="challenges" aria-selected="false">
                    <i class="bi bi-trophy me-2"></i>Challenges
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="quizzes-tab" data-bs-toggle="tab" data-bs-target="#quizzes" type="button" role="tab" aria-controls="quizzes" aria-selected="false">
                    <i class="bi bi-question-circle me-2"></i>Quizzes
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="activity-tab" data-bs-toggle="tab" data-bs-target="#activity" type="button" role="tab" aria-controls="activity" aria-selected="false">
                    <i class="bi bi-activity me-2"></i>Activity
                </button>
            </li>
        </ul>
    </div>

    <!-- Main Content and Sidebar -->
    <div class="container">
        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-8">
                <div class="tab-content" id="profileTabsContent">
                    <!-- Overview Tab -->
                    <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                        <div class="main-content">
                            <h2 class="mb-4">Welcome back, <span th:text="${user?.firstName ?: 'User'}">User</span>!</h2>
                            
                            <!-- Bio Section -->
                            <div th:if="${user?.bio}" class="mb-4">
                                <h4>About</h4>
                                <div class="bg-light p-3 rounded" th:text="${user.bio}">
                                    User bio...
                                </div>
                            </div>
                            
                            <!-- Quick Actions -->
                            <div class="mb-4">
                                <h4>Quick Actions</h4>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <a href="/marketplace" class="btn btn-success w-100">
                                            <i class="bi bi-shop me-2"></i>Browse Marketplace
                                        </a>
                                    </div>
                                    <div class="col-md-6">
                                        <a href="/calculator" class="btn btn-outline-success w-100">
                                            <i class="bi bi-calculator me-2"></i>Calculate Impact
                                        </a>
                                    </div>
                                    <div class="col-md-6">
                                        <a href="/educatie" class="btn btn-outline-success w-100">
                                            <i class="bi bi-book me-2"></i>Take Lessons
                                        </a>
                                    </div>
                                    <div class="col-md-6">
                                        <a href="/provocari" class="btn btn-outline-success w-100">
                                            <i class="bi bi-trophy me-2"></i>View Challenges
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Challenges Tab -->
                    <div class="tab-pane fade" id="challenges" role="tabpanel" aria-labelledby="challenges-tab">
                        <div class="main-content">
                            <h2 class="mb-4">My Challenges</h2>
                            
                            <!-- Active Challenges -->
                            <div th:if="${not #lists.isEmpty(activeChallenges)}" class="mb-4">
                                <h4>Active Challenges</h4>
                                <div class="list-group">
                                    <div th:each="challenge : ${activeChallenges}" class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1" th:text="${challenge.challenge.name}">Challenge Name</h6>
                                            <small class="text-success">Active</small>
                                        </div>
                                        <p class="mb-1" th:text="${challenge.challenge.description}">Challenge description...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Completed Challenges -->
                            <div th:if="${not #lists.isEmpty(completedChallenges)}" class="mb-4">
                                <h4>Completed Challenges</h4>
                                <div class="list-group">
                                    <div th:each="challenge : ${completedChallenges}" class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1" th:text="${challenge.challenge.name}">Challenge Name</h6>
                                            <small class="text-success">Completed</small>
                                        </div>
                                        <p class="mb-1" th:text="${challenge.challenge.description}">Challenge description...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- No Challenges -->
                            <div th:if="${#lists.isEmpty(activeChallenges) && #lists.isEmpty(completedChallenges)}" class="empty-state">
                                <i class="bi bi-trophy empty-state-icon"></i>
                                <h3 class="empty-state-title">No Challenges Yet</h3>
                                <p class="empty-state-text">Start your eco-friendly journey by taking on some challenges!</p>
                                <a href="/provocari" class="btn btn-success">View Challenges</a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quizzes Tab -->
                    <div class="tab-pane fade" id="quizzes" role="tabpanel" aria-labelledby="quizzes-tab">
                        <div class="main-content">
                            <h2 class="mb-4">Lecții Completate</h2>
                            
                            <!-- Completed Lessons Cards -->
                            <div th:if="${not #lists.isEmpty(completedLessons)}" class="mb-4">
                                <div class="row g-4">
                                    <div th:each="lesson : ${completedLessons}" class="col-md-6 col-lg-4">
                                        <div class="card lesson-completion-card h-100">
                                            <div class="position-relative">
                                                <img th:if="${lesson.imageUrl}" th:src="${lesson.imageUrl}" 
                                                     class="card-img-top lesson-image" alt="Lesson Image">
                                                <img th:unless="${lesson.imageUrl}" src="/images/lesson-default.jpg" 
                                                     class="card-img-top lesson-image" alt="Lesson Image">
                                                
                                                <!-- Points Badge -->
                                                <span class="points-badge position-absolute top-0 end-0 m-3">
                                                    <i class="bi bi-star-fill me-1"></i>
                                                    <span th:text="${lesson.pointsEarned}">0</span> puncte
                                                </span>
                                            </div>
                                            
                                            <div class="card-body">
                                                <h5 class="card-title" th:text="${lesson.title}">Lesson Title</h5>
                                                
                                                <!-- Reflection Text (Scrie section) -->
                                                <div th:if="${lesson.reflectionText != null and !lesson.reflectionText.isEmpty()}" class="mt-3">
                                                    <h6 class="text-muted mb-2">Reflecțiile tale:</h6>
                                                    <p class="card-text reflection-text" th:text="${lesson.reflectionText}">User reflection text...</p>
                                                </div>
                                                
                                                <!-- Completion Date -->
                                                <small class="text-muted">
                                                    <i class="bi bi-calendar-check me-1"></i>
                                                    Completat pe <span th:text="${#temporals.format(lesson.completedAt, 'dd MMM yyyy')}">Jan 15, 2023</span>
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- No Completed Lessons -->
                            <div th:if="${#lists.isEmpty(completedLessons)}" class="empty-state">
                                <i class="bi bi-book empty-state-icon"></i>
                                <h3 class="empty-state-title">Nu ai completat nicio lecție încă</h3>
                                <p class="empty-state-text">Începe să înveți despre sustenabilitate și obține puncte!</p>
                                <a href="/educatie" class="btn btn-success">Începe Lecțiile</a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Activity Tab -->
                    <div class="tab-pane fade" id="activity" role="tabpanel" aria-labelledby="activity-tab">
                        <div class="main-content">
                            <h2 class="mb-4">Recent Activity</h2>
                            <div class="empty-state">
                                <i class="bi bi-activity empty-state-icon"></i>
                                <h3 class="empty-state-title">No Recent Activity</h3>
                                <p class="empty-state-text">Your recent activities will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="col-lg-4">
                <div class="sidebar">
                    <!-- Quick Stats -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Your Stats</h3>
                        <div class="stat-card">
                            <div class="stat-value" th:text="${activeChallenges != null ? activeChallenges.size() : 0}">0</div>
                            <div class="stat-label">Active Challenges</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" th:text="${completedChallenges != null ? completedChallenges.size() : 0}">0</div>
                            <div class="stat-label">Completed Challenges</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" th:text="${quizResults != null ? quizResults.size() : 0}">0</div>
                            <div class="stat-label">Quizzes Taken</div>
                        </div>
                    </div>
                    
                    <!-- Eco Impact Summary -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Your Eco Impact</h3>
                        <div class="stat-card">
                            <div class="stat-value" th:text="${user != null ? (user.points * 0.5) : 0}">0</div>
                            <div class="stat-label">CO₂ kg Saved</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" th:text="${user != null ? (user.points / 10) : 0}">0</div>
                            <div class="stat-label">Eco Actions</div>
                        </div>
                    </div>
                    
                    <!-- Quick Links -->
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">Quick Links</h3>
                        <div class="d-grid gap-2">
                            <a href="/dashboard" class="btn btn-success">
                                <i class="bi bi-speedometer2 me-2"></i>Dashboard
                            </a>
                            <a href="/friends" class="btn btn-outline-success">
                                <i class="bi bi-people me-2"></i>Friends
                            </a>
                            <a href="/inbox" class="btn btn-outline-success">
                                <i class="bi bi-inbox me-2"></i>Messages
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer th:replace="fragments/footer :: footer"></footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Bootstrap tabs
            const triggerTabList = document.querySelectorAll('#profileTabs button[data-bs-toggle="tab"]');
            triggerTabList.forEach(triggerEl => {
                const tabTrigger = new bootstrap.Tab(triggerEl);
                
                triggerEl.addEventListener('click', event => {
                    event.preventDefault();
                    tabTrigger.show();
                });
            });
        });
    </script>
</body>
</html> 